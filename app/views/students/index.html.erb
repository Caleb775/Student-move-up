<% content_for :title, "Student Rankings - Student Records Management System" %>

<div class="container mt-4">
  <div class="row">
    <div class="col-12">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="display-4 text-primary">Student Rankings</h1>
        <% if can?(:create, Student) %>
          <%= link_to 'Add New Student', new_student_path, class: "btn btn-primary btn-lg" %>
        <% end %>
      </div>

      <!-- Search and Filter Form -->
      <%= render 'search_form' %>

      <!-- Search Results Info -->
      <% if params[:q].present? || params[:filters].present? %>
        <div class="alert alert-info">
          <i class="bi bi-info-circle"></i>
          <% if params[:q].present? %>
            Search results for "<strong><%= params[:q] %></strong>"
          <% end %>
          <% if params[:filters].present? %>
            with applied filters
          <% end %>
          - <%= pluralize(@students.total_count, 'student') %> found
          <%= link_to 'Clear search', students_path, class: "btn btn-sm btn-outline-secondary ms-2" %>
        </div>
      <% end %>

      <% if @students.any? %>
        <div class="card shadow">
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-striped table-hover">
                <thead class="table-dark">
                  <tr>
                    <th scope="col">Rank</th>
                    <th scope="col">Name</th>
                    <th scope="col">Reading</th>
                    <th scope="col">Writing</th>
                    <th scope="col">Listening</th>
                    <th scope="col">Speaking</th>
                    <th scope="col">Total</th>
                    <th scope="col">Percentage</th>
                    <th scope="col">Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <% @students.each_with_index do |student, index| %>
                    <tr>
                      <td>
                        <span class="badge bg-<%= index < 3 ? 'warning' : 'secondary' %>">
                          #<%= index + 1 %>
                        </span>
                      </td>
                      <td><strong><%= student.name %></strong></td>
                      <td><span class="badge bg-info"><%= student.reading %></span></td>
                      <td><span class="badge bg-info"><%= student.writing %></span></td>
                      <td><span class="badge bg-info"><%= student.listening %></span></td>
                      <td><span class="badge bg-info"><%= student.speaking %></span></td>
                      <td><strong><%= student.total_score %></strong></td>
                      <td>
                        <span class="badge bg-<%= student.percentage >= 80 ? 'success' : student.percentage >= 60 ? 'warning' : 'danger' %>">
                          <%= student.percentage.round(2) %>%
                        </span>
                      </td>
                      <td>
                        <div class="btn-group" role="group">
                          <% if can?(:show, student) %>
                            <%= link_to 'Show', student_path(student), class: "btn btn-outline-primary btn-sm" %>
                          <% end %>
                          
                          <% if can?(:update, student) %>
                            <%= link_to 'Edit', edit_student_path(student), class: "btn btn-outline-warning btn-sm" %>
                          <% end %>
                          
                          <% if can?(:destroy, student) %>
                            <%= link_to 'Delete', student_path(student), 
                                data: { "turbo-method": "delete", confirm: 'Are you sure?' }, 
                                class: "btn btn-outline-danger btn-sm" %>
                          <% end %>
                        </div>
                      </td>
                    </tr>
                  <% end %>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Pagination -->
        <div class="d-flex justify-content-center mt-4">
          <%= paginate @students %>
        </div>
      <% else %>
        <div class="card">
          <div class="card-body text-center py-5">
            <h3 class="text-muted">No students yet</h3>
            <p class="text-muted">Get started by adding your first student!</p>
            <% if can?(:create, Student) %>
              <%= link_to 'Add a student', new_student_path, class: "btn btn-primary btn-lg" %>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>
