<% content_for :title, "#{@student.name} - Student Details - Student Records Management System" %>

<div class="container mt-4">
  <div class="row justify-content-center">
    <div class="col-md-8">
      <div class="card shadow">
        <div class="card-header bg-primary text-white">
          <h2 class="card-title mb-0">
            <i class="bi bi-person-circle me-2"></i>
            Student Details: <%= @student.name %>
          </h2>
        </div>
        <div class="card-body">
          <div class="row mb-4">
            <div class="col-md-6">
              <div class="card bg-light">
                <div class="card-body text-center">
                  <h5 class="card-title text-primary">Total Score</h5>
                  <h2 class="text-primary"><%= @student.total_score %>/40</h2>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="card bg-light">
                <div class="card-body text-center">
                  <h5 class="card-title text-primary">Percentage</h5>
                  <h2 class="text-<%= @student.percentage >= 80 ? 'success' : @student.percentage >= 60 ? 'warning' : 'danger' %>">
                    <%= @student.percentage.round(2) %>%
                  </h2>
                </div>
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-md-3 mb-3">
              <div class="card text-center">
                <div class="card-body">
                  <h6 class="card-title">Reading</h6>
                  <span class="badge bg-info fs-4"><%= @student.reading %></span>
                </div>
              </div>
            </div>
            <div class="col-md-3 mb-3">
              <div class="card text-center">
                <div class="card-body">
                  <h6 class="card-title">Writing</h6>
                  <span class="badge bg-info fs-4"><%= @student.writing %></span>
                </div>
              </div>
            </div>
            <div class="col-md-3 mb-3">
              <div class="card text-center">
                <div class="card-body">
                  <h6 class="card-title">Listening</h6>
                  <span class="badge bg-info fs-4"><%= @student.listening %></span>
                </div>
              </div>
            </div>
            <div class="col-md-3 mb-3">
              <div class="card text-center">
                <div class="card-body">
                  <h6 class="card-title">Speaking</h6>
                  <span class="badge bg-info fs-4"><%= @student.speaking %></span>
                </div>
              </div>
            </div>
          </div>

          <!-- Notes Section -->
          <div class="mt-4">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <h5 class="mb-0">
                <i class="bi bi-sticky me-2"></i>
                Teacher Notes
              </h5>
              <% if can?(:create, Note) %>
                <%= link_to 'Add Note', new_student_note_path(@student), class: "btn btn-success btn-sm" %>
              <% end %>
            </div>
            
            <% if @student.notes.any? %>
              <div class="notes-container">
                <% @student.notes.order(created_at: :desc).each do |note| %>
                  <div class="card mb-3">
                    <div class="card-body">
                      <div class="d-flex justify-content-between align-items-start">
                        <div class="flex-grow-1">
                          <p class="card-text mb-2"><%= note.content %></p>
                          <small class="text-muted">
                            <i class="bi bi-clock me-1"></i>
                            <%= note.created_at.strftime("%B %d, %Y at %I:%M %p") %>
                            <% if note.user %>
                              by <strong><%= note.user.first_name %> <%= note.user.last_name %></strong>
                            <% end %>
                          </small>
                        </div>
                        <% if can?(:update, note) || can?(:destroy, note) %>
                          <div class="btn-group btn-group-sm" role="group">
                            <% if can?(:update, note) %>
                              <%= link_to 'Edit', edit_student_note_path(@student, note), class: "btn btn-outline-warning btn-sm" %>
                            <% end %>
                            <% if can?(:destroy, note) %>
                              <%= link_to 'Delete', student_note_path(@student, note), 
                                  method: :delete, 
                                  data: { confirm: 'Are you sure you want to delete this note?' }, 
                                  class: "btn btn-outline-danger btn-sm" %>
                            <% end %>
                          </div>
                        <% end %>
                      </div>
                    </div>
                  </div>
                <% end %>
              </div>
            <% else %>
              <div class="alert alert-info">
                <i class="bi bi-info-circle me-2"></i>
                No notes yet.
                <% if can?(:create, Note) %>
                  Click "Add Note" to add the first note for this student.
                <% end %>
              </div>
            <% end %>
          </div>

          <div class="d-flex justify-content-between mt-4">
            <%= link_to 'Back to Rankings', students_path, class: "btn btn-secondary" %>
            <div>
              <% if can?(:update, @student) %>
                <%= link_to 'Edit Student', edit_student_path(@student), class: "btn btn-warning me-2" %>
              <% end %>
              <% if can?(:destroy, @student) %>
                <%= link_to 'Delete Student', student_path(@student), 
                    data: { "turbo-method": "delete", confirm: 'Are you sure you want to delete this student?' }, 
                    class: "btn btn-danger" %>
              <% end %>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
