<%= form_with url: students_path, method: :get, local: true, class: "search-form" do |form| %>
  <div class="row mb-4">
    <!-- Search Input -->
    <div class="col-md-6">
      <div class="input-group">
        <%= form.text_field :q, 
            value: params[:q], 
            placeholder: "Search students by name or notes...", 
            class: "form-control",
            id: "search-input",
            autocomplete: "off" %>
        <button class="btn btn-outline-secondary" type="submit">
          <i class="bi bi-search"></i>
        </button>
      </div>
      <div id="search-suggestions" class="list-group position-absolute w-100" style="z-index: 1000; display: none;"></div>
    </div>

    <!-- Sort Options -->
    <div class="col-md-3">
      <%= form.select :sort, 
          options_for_select([
            ['Highest Scores', 'percentage_desc'],
            ['Lowest Scores', 'percentage_asc'],
            ['Name A-Z', 'name_asc'],
            ['Name Z-A', 'name_desc'],
            ['Newest First', 'created_desc'],
            ['Oldest First', 'created_asc']
          ], params[:sort]), 
          { prompt: 'Sort by...' }, 
          { class: "form-select" } %>
    </div>

    <!-- Advanced Filters Toggle -->
    <div class="col-md-3">
      <button type="button" class="btn btn-outline-primary w-100" data-bs-toggle="collapse" data-bs-target="#advancedFilters">
        <i class="bi bi-funnel"></i> Advanced Filters
      </button>
    </div>
  </div>

  <!-- Advanced Filters -->
  <div class="collapse" id="advancedFilters">
    <div class="card card-body mb-4">
      <h5 class="card-title">Advanced Filters</h5>
      <div class="row">
        <!-- Score Range -->
        <div class="col-md-3">
          <label class="form-label">Total Score Range</label>
          <div class="row">
            <div class="col-6">
              <%= form.number_field "filters[min_score]", 
                  value: params.dig(:filters, :min_score),
                  placeholder: "Min", 
                  class: "form-control",
                  min: 0, max: 40 %>
            </div>
            <div class="col-6">
              <%= form.number_field "filters[max_score]", 
                  value: params.dig(:filters, :max_score),
                  placeholder: "Max", 
                  class: "form-control",
                  min: 0, max: 40 %>
            </div>
          </div>
        </div>

        <!-- Percentage Range -->
        <div class="col-md-3">
          <label class="form-label">Percentage Range</label>
          <div class="row">
            <div class="col-6">
              <%= form.number_field "filters[min_percentage]", 
                  value: params.dig(:filters, :min_percentage),
                  placeholder: "Min %", 
                  class: "form-control",
                  min: 0, max: 100, step: 0.1 %>
            </div>
            <div class="col-6">
              <%= form.number_field "filters[max_percentage]", 
                  value: params.dig(:filters, :max_percentage),
                  placeholder: "Max %", 
                  class: "form-control",
                  min: 0, max: 100, step: 0.1 %>
            </div>
          </div>
        </div>

        <!-- Individual Skills -->
        <div class="col-md-3">
          <label class="form-label">Minimum Skills</label>
          <div class="row">
            <div class="col-6">
              <%= form.number_field "filters[min_reading]", 
                  value: params.dig(:filters, :min_reading),
                  placeholder: "Reading", 
                  class: "form-control mb-1",
                  min: 0, max: 10 %>
            </div>
            <div class="col-6">
              <%= form.number_field "filters[min_writing]", 
                  value: params.dig(:filters, :min_writing),
                  placeholder: "Writing", 
                  class: "form-control mb-1",
                  min: 0, max: 10 %>
            </div>
            <div class="col-6">
              <%= form.number_field "filters[min_listening]", 
                  value: params.dig(:filters, :min_listening),
                  placeholder: "Listening", 
                  class: "form-control",
                  min: 0, max: 10 %>
            </div>
            <div class="col-6">
              <%= form.number_field "filters[min_speaking]", 
                  value: params.dig(:filters, :min_speaking),
                  placeholder: "Speaking", 
                  class: "form-control",
                  min: 0, max: 10 %>
            </div>
          </div>
        </div>

        <!-- Date Range -->
        <div class="col-md-3">
          <label class="form-label">Date Range</label>
          <div class="row">
            <div class="col-12">
              <%= form.date_field "filters[created_after]", 
                  value: params.dig(:filters, :created_after),
                  class: "form-control mb-2" %>
            </div>
            <div class="col-12">
              <%= form.date_field "filters[created_before]", 
                  value: params.dig(:filters, :created_before),
                  class: "form-control" %>
            </div>
          </div>
        </div>
      </div>

      <!-- Filter Actions -->
      <div class="row mt-3">
        <div class="col-12">
          <%= form.submit "Apply Filters", class: "btn btn-primary me-2" %>
          <%= link_to "Clear All", students_path, class: "btn btn-outline-secondary" %>
        </div>
      </div>
    </div>
  </div>
<% end %>
